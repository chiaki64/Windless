function slide(){var e=$("#drop-cat ul");$["class"].has($("#drop-cat"),"open")?(e.style.height="0",$["class"].remove($("#drop-cat"),"open")):(e.style.height=(56*$("#drop-cat ul").children.length).toString()+"px",$["class"].add($("#drop-cat"),"open"))}function slide_archive(e){var a=$('.archive-posts[data-month="'+e+'"]'),t=$('.archive-posts[data-month="'+e+'"] ul');$["class"].has(a,"open")?(t.style.height="0",$["class"].remove(a,"open")):(t.style.height=(24*t.children.length).toString()+"px",$["class"].add(a,"open"))}function change(){se.getItem("index")&&se.getItem("current")&&(audio.currentTime=parseFloat(se.getItem("current")))}function initPlayer(e){audio.setAttribute("src",musicList[e].Source),$(".song").innerHTML=musicList[e].Title,$(".album").innerHTML=musicList[e].Album,changePorgress($(".progress"),0)}function toPlay(e){"play"==e?(audio.play(),removeClass($(".pause"),"hidden"),addClass($(".play"),"hidden"),se.setItem("pause",0)):"pause"==e?(audio.pause(),removeClass($(".play"),"hidden"),addClass($(".pause"),"hidden"),se.setItem("pause",1)):"prev"==e?playMusicMode(e):"next"==e&&playMusicMode(e)}function playMusicMode(e){var a=musicList.length,t=musicIndex;"prev"==e?1==t?t=a:t-=1:("next"==e||"ended"==e)&&(t==a?t=1:t+=1),musicIndex=t,playIndex(t-1)}function playIndex(e){initPlayer(e),audio.load(),toPlay("play"),se.setItem("index",e+1)}function changePorgress(e,a){50>=a?(left.style.webkitTransform="rotate("+3.6*a+"deg)",right.style.opacity=0,mask.style.opacity=1):(right.style.opacity=1,mask.style.opacity=0,left.style.webkitTransform="rotate(180deg)",right.style.webkitTransform="rotate("+3.6*a+"deg)")}function hasClass(e,a){for(var s,t=e.className.split(" "),n=0;n<t.length;n++){if(t[n]==a){s=!0;break}s=!1}return s}function addClass(e,a){hasClass(e,a)||(e.className+=" "+a)}function removeClass(e,a){if(hasClass(e,a))for(var t=e.className.split(" "),s=0;s<t.length;s++)if(t[s]==a){t.splice(s,1),e.className=t.join(" ");break}}function replaceClass(e,a,t){if(hasClass(e,a))for(var s=e.className.split(" "),n=0;n<s.length;n++)if(s[n]==a){s.splice(n,1,t),e.className=a.join(" ");break}}function playMusic(e){toPlay("pause"),hasClass($("#music"),"hidden")&&removeClass($("#music"),"hidden"),audio.setAttribute("src",e.Source),$(".song").innerHTML=e.Title,$(".album").innerHTML=e.Album,$(".progress").style.width="0px",audio.removeEventListener("canplay",bufferBar,!1),clearInterval(bufferTimer),$(".buffer").style.width="0px"}function toTimestamp(e){var a=new Date(e);return Date.parse(a)}function getDateDiff(e){var a=6e4,t=60*a,s=24*t,r=30*s,o=365*s,i=Date.parse(new Date),l=i-e;if(!(0>l)){var c=l/o,d=l/r,u=l/(7*s),m=l/s,f=l/t,p=l/a;return c>=1?result=""+parseInt(c)+"年前":d>=1?result=""+parseInt(d)+"月前":u>=1?result=""+parseInt(u)+"周前":m>=1?result=""+parseInt(m)+"天前":f>=1?result=""+parseInt(f)+"小时前":p>=1?result=""+parseInt(p)+"分钟前":result="刚刚",result}}function simple_comment(e){var a=document.createElement("li");a.className="comment-li",a.dataset.thread=e.id,a.dataset.author=e.author.name;var t="",s="";return arguments.length>=2&&(t=arguments[1],s="<span> &nbsp;回复 "+t+"</span>"),a.innerHTML='<div class="comment-content"><div class="avatar"><img src="'+e.author.avatar.cache+'" alt=""></div><div class="comment-body"><header class="comment-header"><span class="author"><a href="'+e.author.profileUrl+'">'+e.author.name+"</a></span>"+s+'<span class="meta"><span class="bullet bullet-first">&nbsp;•&nbsp;</span>'+getDateDiff(toTimestamp(e.createdAt))+'<span class="bullet bullet-first">&nbsp;•&nbsp;</span><a href="javascript:void(0)" class="reply" onclick="reply('+e.id+')">回复</a></span></header><div class="comment-body-inner">'+e.message+'</div></div></div><ul class="children"></ul>',a}function reply(){var e="/disqus?link="+location.href;1==arguments.length&&(e+="&parent="+arguments[0]),window.open(e,"newwindow","height=500, width=400, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no")}function comment_render(e){for(var a=$(".comment .comment-posts"),t=e.length-1;t>=0;t--)if(null==e[t].parent){var s=simple_comment(e[t]);a.append(s)}else{var n=$('.comment .comment-posts li[data-thread="'+e[t].parent+'"]'),s=simple_comment(e[t],n.dataset.author,n.dataset.thread);n.childNodes[1].append(s)}var r=$.all(".comment .comment-posts>.comment-li");a.innerHTML="";for(var t=r.length-1;t>=0;t--)a.append(r[t])}function dropHandler(e){e.stopPropagation(),e.preventDefault();for(var s,a=e.dataTransfer.files,t=0;s=a[t];t++){var n=new FileReader;n.onload=function(e){return function(e){document.body.className="",localStorage.setItem("body__style","background:url("+this.result+") no-repeat fixed center/cover");var a=localStorage.getItem("body__style");document.body.style=a}}(s),n.readAsDataURL(s)}}function dragOverHandler(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dragEffect="copy"}var musicList=[{Artist:"Suara",Album:"「Pure -AQUAPLUS LEGEND OF ACOUSTICS-」",Source:"https://dn-wind-moe.qbox.me/static/music/Suara - 梦想歌.mp3?ver=1.0",Title:"梦想歌",Duration:"247"},{Artist:"Suara",Title:"不安定な神様",Album:"「不安定な神様」",Source:"https://dn-wind-moe.qbox.me/static/music/Suara - 不安定な神様.mp3",Duration:"244"}],se=sessionStorage,audio=$("#audio"),volumeTimer=null;audio.volume=.5,$(".play").onclick=function(){toPlay("play")},$(".pause").onclick=function(){toPlay("pause")},$(".prev").onclick=function(){toPlay("prev")},$(".next").onclick=function(){toPlay("next")},audio.addEventListener("ended",function(){playMusicMode("ended")},!1),audio.addEventListener("timeupdate",function(){if(!isNaN(audio.duration)){sessionStorage.setItem("current",audio.currentTime);var e=audio.currentTime/audio.duration*100;changePorgress($(".progress"),parseInt(e))}},!1);var circle=$(".circle"),mask=$(".mask"),left=$(".left"),right=$(".right");if(se.getItem("index"))var musicIndex=parseInt(se.getItem("index"));else{var musicIndex=1;se.setItem("index",musicIndex)}se.getItem("pause")&&0==se.getItem("pause")&&(setTimeout(function(){audio.play(),change()},150),addClass($(".play"),"hidden"),removeClass($(".pause"),"hidden")),Title=document.title,document.addEventListener("visibilitychange",function(){var e=["╭(′▽`)╯","( ͡° ͜ʖ ͡°)","(ÒܫÓױ)","ヽ( ^∀^)ﾉ","(╯°□°)╯︵","(´・ω・`)","(`皿´)","(¬_¬)",'(￣▽￣)"',"(〒︿〒)"];document.hidden?(document.title=e[parseInt(10*Math.random(),10)]+" "+document.title,clearTimeout(2e3)):document.title=Title}),document.onkeydown=function(e){if(e||(e=window.event),13==(e.keyCode||e.which)){if(0===$("#search-field").value.length)return!1;window.location.href="/?search="+$("#search-field").value}},window.onload=function(){function e(e){for(var a=e.offsetTop;e=e.offsetParent;)a+=e.offsetTop;return a}function s(){var s=$(".container").scrollTop;~function(){t+s+1e3>e(a)&&comment()}()}if("function"==typeof comment){var a=$("#disqus_thread"),t=window.innerHeight;$(".container").addEventListener("scroll",s),s()}document.styleSheets[1].addRule(".drawer-header","background-image: url(/static/img/kuon.png);"),0!==document.body.querySelectorAll(".lazyload").length&&$.img.lazyload(),initPlayer(musicIndex-1)},$("#top-btn").addEventListener("click",function(){function a(){var a=$(".container").scrollTop;return 0===a?void clearInterval(e):void($(".container").scrollTop=.8*a)}var e=setInterval(a,20);$["class"].has($("header"),"above")&&$["class"].remove($("header"),"above")}),$("#open-btn").addEventListener("click",function(){"float-btn-group"==$("#more").className?$("#more").className="float-btn-group open":($("#more").className="float-btn-group",$("#music-more").className="")}),$("#music-btn").addEventListener("click",function(){""==$("#music-more").className?$("#music-more").className="open":$("#music-more").className=""});var dialog=document.querySelector("dialog"),showDialogButton=document.querySelector("#show-dialog");dialog.showModal||dialogPolyfill.registerDialog(dialog),showDialogButton.addEventListener("click",function(){dialog.showModal(),$("#more").className="float-btn-group",$("#music-more").className=""}),dialog.querySelector(".close").addEventListener("click",function(){dialog.close()});var body=document.body;body.addEventListener("drop",dropHandler,!1),body.addEventListener("dragover",dragOverHandler,!1);var headerChange=function(e){e=e||window.event,e.wheelDelta&&(e.wheelDelta<0?$["class"].has($("header"),"above")||$["class"].add($("header"),"above"):e.wheelDelta>0&&$["class"].has($("header"),"above")&&$["class"].remove($("header"),"above"))};document.onmousewheel=headerChange;